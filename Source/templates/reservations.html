<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Reservations - S3-MRS</title>
  <link rel="stylesheet" href="/static/css/style.css">
  <script src="https://unpkg.com/feather-icons"></script>
</head>
<body class="dashboard">
  <aside class="sidebar">
    <div class="logo">S3 - MRS</div>
    <nav>
      <ul>
        <li><a href="/home"><i data-feather="home"></i> Home</a></li>
        <li class="active"><a href="/reservations"><i data-feather="list"></i> Reservations</a></li>
        <li><a href="/checkin-out"><i data-feather="check-square"></i> Check in & out</a></li>
        <li><a href="/devices"><i data-feather="monitor"></i> Device management</a></li>
        <li><a href="/notifications"><i data-feather="bell"></i> Notifications</a></li>
        <li><a href="/settings"><i data-feather="settings"></i> Settings</a></li>
      </ul>
    </nav>
    <div class="reminder">
      <h4>REMINDER</h4>
      <ul>
        {% for sp in reservations %}
          {% if sp.status == 'reserved' and sp.reserved_until %}
          <li>
            <span class="dot green"></span>
            {{ sp.name }} at {{ sp.reserved_until.split('T')[0] }} {{ sp.reserved_until.split('T')[1] }}
          </li>
          {% endif %}
        {% endfor %}
        {% if reservations|selectattr('status','equalto','reserved')|list|length == 0 %}
          <li>No upcoming reservations</li>
        {% endif %}
      </ul>
    </div>
  </aside>

  <header class="topbar">
    <div class="search">
      <input type="text" placeholder="Search for anything...">
      <i data-feather="search"></i>
    </div>
    <div class="top-right">
      <span>Hello, {{ session['user'] }}</span>
      <button class="btn-logout" onclick="location.href='/logout'">Logout</button>
    </div>
  </header>

  <main class="content">
    <h2>Reservations</h2>
    {% with messages = get_flashed_messages(with_categories=true) %}{% endwith %}
    <div class="cards">
      {% for sp in spaces %}
      <div class="card">
        <h3>{{ sp.name }}</h3>
        <p>{{ sp.type }}</p>
        <form method="POST">
          <input type="hidden" name="space_id" value="{{ sp.id }}">
          {% if sp.status == 'available' %}
            <label>Date & Time:
              <input type="datetime-local" name="datetime" required>
            </label>
            <label>Equipment:
              <select name="equipment" required>
                {% for eq in sp.equipment %}
                <option value="{{ eq }}">{{ eq }}</option>
                {% endfor %}
              </select>
            </label>
            <button type="submit" name="action" value="reserve" class="btn-primary-register">Reserve</button>
          {% elif sp.status == 'reserved' %}
            <button type="submit" name="action" value="checkin" class="btn-secondary-register">Check-In</button>
          {% elif sp.status == 'occupied' %}
            <button type="submit" name="action" value="checkout" class="btn-secondary-register">Check-Out</button>
          {% endif %}
        </form>
        <small>
          Status: {{ sp.status }}
          {% if sp.reserved_until %} at {{ sp.reserved_until.split('T')[0] }} {{ sp.reserved_until.split('T')[1] }}{% endif %}
          {% if sp.equipment %} with {{ sp.equipment }}{% endif %}
        </small>
      </div>
      {% endfor %}
    </div>
  </main>
  <script>feather.replace()</script>
</body>
</html>